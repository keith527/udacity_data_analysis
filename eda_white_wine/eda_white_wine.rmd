探索白葡萄酒的化学成分对酒品质的影响
========================================================

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# 加载你最终使用的所有组件
# 在这个代码块的分析中。

# 注意，在这个代码块中，将参数 "echo" 设为假。
# This prevents the code from displaying in the knitted HTML output.这可以避免代码混入 HTML 输出显示。
# 应当在文件中，对所有代码块设为 echo=FALSE 。
#install.packages('ggplot2')
#install.packages('dplyr')
#install.packages('gridExtra')
library(ggplot2)
library(dplyr)
library(gridExtra)
library(GGally)
library(knitr)

```
```{r set theme }
theme_set(theme_minimal(5))
```

# 数据处理
### 加载数据
```{r echo=FALSE, Load_the_Data}
# 加载数据
data_white_wine_origin <- read.csv('wineQualityWhites.csv')
head(data_white_wine_origin)
```
### 查看字段
```{r}
names(data_white_wine_origin)
```

# 单变量绘图选择
### 绘制各直方图
```{r echo=FALSE, Univariate_Plots}
p1.1 <- qplot(x=fixed.acidity, data=data_white_wine_origin)
p1.2 <- qplot(x=volatile.acidity, data=data_white_wine_origin)
p1.3 <- qplot(x=citric.acid, data=data_white_wine_origin)
p1.4 <- qplot(x=residual.sugar, data=data_white_wine_origin)
p1.5 <- qplot(x=chlorides, data=data_white_wine_origin)
p1.6 <- qplot(x=free.sulfur.dioxide, data=data_white_wine_origin)
p1.7 <- qplot(x=total.sulfur.dioxide, data=data_white_wine_origin)
p1.8 <- qplot(x=density, data=data_white_wine_origin)
p1.9 <- qplot(x=pH, data=data_white_wine_origin)
p1.10 <- qplot(x=sulphates, data=data_white_wine_origin)
p1.11 <- qplot(x=alcohol, data=data_white_wine_origin)
p1.12 <- qplot(x=quality, data=data_white_wine_origin)
grid.arrange(p1.1, p1.2, p1.3, p1.4, p1.5, p1.6, p1.7, p1.8, p1.9, p1.10, p1.11, p1.12, ncol=3)
```

### 查看各变量统计值
```{r echo=FALSE,}
summary(data_white_wine_origin)
```
### 创建一个新的变量 is.sweet
创建变量记录每只酒是否是甜的
超过45克/升的葡萄酒被认为是甜的
```{r echo=FALSE}
data_white_wine_origin$is.sweet <- ifelse(data_white_wine_origin$residual.sugar>45,1,0)
data_white_wine_origin$is.sweet <- factor(data_white_wine_origin$is.sweet)
```
### 看下有多少甜的
```{r echo=FALSE}
summary(data_white_wine_origin$is.sweet)
```
### 创建一个新的变量 总酸度
```{r}
data_white_wine_origin$total.acidity <- data_white_wine_origin$fixed.acidity+data_white_wine_origin$volatile.acidity+data_white_wine_origin$citric.acid
summary(data_white_wine_origin$total.acidity)
```

# 单变量分析

### 你的数据集结构是什么？
数据集包含 4898 种白葡萄酒，以及 11 个关于酒的化学成分变量，分别为：
fixed.acidity：固定酸度
volatile.acidity：挥发性酸度
citric.acid：柠檬酸
residual.sugar：残糖
chlorides：氯化物
free.sulfur.dioxide：游离二氧化硫
total.sulfur.dioxide：二氧化硫总量  (mg / dm^3)
density：密度(mg / cm^3)
pH：pH值
sulphates：硫酸盐(g / dm^3)
alcohol：醇/酒精(% by volume)
quality：质量：0-10分
is.sweet:口感是否甜
total.acidity:总酸度 = fixed.acidity + volatile.acidity + citric.acid

### 你的数据集内感兴趣的主要特性有哪些？
酸：total.acidity
甜：residual.sugar
酒精：alcohol
质量：quality

### 你认为数据集内哪些其他特征可以帮助你探索兴趣特点？
酸碱度：pH
密度：density

### 根据数据集内已有变量，你是否创建了任何新变量？
1. is.sweet:是否为甜的酒
2. total.acidity:总酸度

### 在已经探究的特性中，是否存在任何异常分布？你是否对数据进行一些操作，如清洁、调整或改变数据的形式？如果是，你为什么会这样做？
看起来都是正态分布


# 双变量绘图选择

### 相关性计算
```{r echo=FALSE, Bivariate_Plots}
ggcorr(data_white_wine_origin[,], label = TRUE, label_size = 3, label_round = 2, hjust = 0.85)
```
相关性比较大的变量为：
正相关
1. total.acidity 与 fixed.acidity：0.99
2. redidual.sugar 与 density :0.84
3. free.sulfur.dioxide 与 total.sulfur.dioxide:0.62
4. total.sulfur.dioxide 与 density :0.53

负相关
1. density 与 alcohol:-0.78

### 探索 alcohol 与 quality 的关系 
```{r}
ggplot(aes(x = quality, y = alcohol), 
      data = data_white_wine_origin)  + 
  geom_boxplot(alpha = 0.2, color = "blue") + 
  geom_jitter(alpha = 0.2) + 
  #stat_summary(fun.y = mean, geom = 'point', shape = 4, color = "red") + 
  geom_smooth(method = 'lm', aes(group = 1)) 
```
随着质量的提升，酒精含量也相对更高

### 探索 residual.sugar 与 density 的关系   
```{r echo=FALSE}
ggplot(aes(x = residual.sugar, y = density), 
      data = data_white_wine_origin)  + 
  geom_point(aes(alpha=0.2),position = position_jitter())+
  geom_smooth(method = 'lm') 
```
可以看出残糖和密度之间很明显的线性关系，随着残糖含量的提升，密度将会变大，可能会造成口感上更粘稠和厚重。

### 探索 total.sulfur.dioxide 与 density 的关系   
```{r echo=FALSE}
ggplot(aes(x = total.sulfur.dioxide, y = density), 
      data = data_white_wine_origin)  + 
  geom_point(aes(alpha=0.2),position = position_jitter())+
  geom_smooth(method = 'lm') 
```
密度与二氧化硫总量正相关

### 探索 density 与 alcohol 的关系 
```{r echo=FALSE}
ggplot(aes(x = density, y = alcohol), 
      data = data_white_wine_origin)  + 
  geom_point(aes(alpha=0.2),position = position_jitter())+
  xlim(c(0.98,1.01))+
  geom_smooth(method = 'lm') 
```
酒精与白葡萄酒的密度成明显的负相关，随着白葡萄的密度增大，酒精含量反而下降了。

### 残糖与酒精
```{r echo=FALSE}
ggplot(aes(x=residual.sugar, y=alcohol), data=data_white_wine_origin)+
  geom_point(aes(alpha=0.2),position = position_jitter())+
  geom_smooth(method = 'lm', color='blue')
```
残糖与酒精呈现弱的负相关

### alcohol 和  total.sulfur.dioxide
```{r echo=FALSE}
ggplot(aes(x=alcohol, y=total.sulfur.dioxide), data=data_white_wine_origin)+
  geom_point(aes(alpha=0.2),position = position_jitter())+
  geom_smooth(method = 'lm', color='blue')
```

酒精和二氧化硫总量好像没啥关系

### pH 与alcohol
```{r echo=FALSE}
ggplot(aes(x=pH, y=alcohol), data=data_white_wine_origin)+
  geom_point(aes(alpha=0.2),position = position_jitter())+
  geom_smooth(method = 'lm', color='blue')
```
pH与酒精含量没关系

# 双变量分析

### 探讨你在这部分探究中观察到的一些关系。这些感兴趣的特性与数据集内其他特性有什么区别？
这部分主要根据变量之间的相关性和自己的直觉选择一些变量进行观察：
1. 可以看出残糖和密度之间很明显的线性关系，随着残糖含量的提升，密度将会变大，可能会造成口感上更粘稠和厚重。
2.酒精和密度却成负相关，可能因为酒精比水的密度小；

### 你是否观察到主要特性与其他特性之间的有趣关系？
密度与二氧化硫总量正相关
酒精与白葡萄酒的密度成明显的负相关，随着白葡萄的密度增大，酒精含量反而下降了。
残糖与酒精呈现弱的负相关

### 你发现最强的关系是什么？
最强的关系是residual.sugar 和 density的关系，从图中可以看出，两者正相关关系很明显，且相关系数为 0.84 .  


# 多变量绘图选择

```{r echo=FALSE, Multivariate_Plots}
names(data_white_wine_origin)
```

考虑在双变量分析中有明显相关性的两组变量散点图上添加颜色来表示酒的质量来观察三者间的关系
### 探索 alcohol、density 和 quality之间的关系
```{r echo=FALSE}
ggplot(aes(x = alcohol, y = density, color = quality), data = data_white_wine_origin) + 
  geom_jitter(alpha = 0.25, color=I('#F79420')) + 
  geom_smooth(method = "lm", se = FALSE,size=1) + 
  ylim(0.985, 1.005) + 
  labs(y = 'Density',x = 'Alcohol') + 
  ggtitle("density VS alcohol VS quality")
```
如图可以看出：
当酒精含量（alcohol）一定时，密度（density）越高，quality的颜色越深，也就是说质量更高

### 探索 residual.sugar，density，和quality 的关系    
```{r echo=FALSE}
ggplot(aes(x = residual.sugar, y = density, color = quality), 
       data = data_white_wine_origin) + 
  geom_jitter(alpha = 0.25,color=I('#F79420')) + 
  xlim(0,40)+
  ylim(0.985, 1.005)+
  geom_smooth(method = "lm", se = FALSE,size=1) + 
  labs(x = 'Residual Sugar',y = 'Density') + 
  ggtitle("Residual Sugar VS Density VS Quality")
```
如图可以看出：
在残糖含量（residual.sugar）较低的时候，颜色比较深，意味着大多数评分高的酒残糖含量并不高

# 多变量分析

###  探讨你在这部分探究中观察到的一些关系。通过观察感兴趣的特性，是否存在相互促进的特性？

酒精含量越高的酒评分相对越高，而残糖含量越高的酒评分却越低，所以酒精含量和残糖含量可能是对“冤家”

### 这些特性之间是否存在有趣或惊人的联系呢？
不知道

### 选项：你是否创建过数据集的任何模型？讨论你模型的优缺点。
暂时没有。
------

# 定稿图与总结

### 绘图一
```{r echo=FALSE, Plot_One}
p1.1 <- qplot(x=total.acidity, data=data_white_wine_origin)
p1.4 <- qplot(x=residual.sugar, data=data_white_wine_origin)
p1.5 <- qplot(x=chlorides, data=data_white_wine_origin)
p1.6 <- qplot(x=free.sulfur.dioxide, data=data_white_wine_origin)
p1.7 <- qplot(x=total.sulfur.dioxide, data=data_white_wine_origin)
p1.8 <- qplot(x=density, data=data_white_wine_origin)
p1.9 <- qplot(x=pH, data=data_white_wine_origin)
p1.10 <- qplot(x=sulphates, data=data_white_wine_origin)
p1.11 <- qplot(x=alcohol, data=data_white_wine_origin)
p1.12 <- qplot(x=quality, data=data_white_wine_origin)
grid.arrange(p1.1, p1.4, p1.5, p1.6, p1.7, p1.8, p1.9, p1.10, p1.11, p1.12, ncol=3)
```

### 描述一
1. 整体来说，各白葡萄就的指标参数都符合正态分布
2. 质量评分的范围为[3,9]，5，6，7分的数量占绝大部分，其中又以 6 分最多，表示数据集中的酒质量差别不大

### 绘图二
```{r echo=FALSE, Plot_Two}
ggplot(aes(x = residual.sugar, y = density), 
      data = data_white_wine_origin)  + 
  geom_point(aes(alpha=0.2),position = position_jitter())+
  geom_smooth(method = 'lm') +
  ggtitle("Density by Residual Sugar") + 
  labs(x = 'Residual Sugar',y = 'Density')
```
```{r echo=FALSE}
ggplot(aes(x = density, y = alcohol), 
      data = data_white_wine_origin)  + 
  geom_point(aes(alpha=0.2),position = position_jitter())+
  xlim(c(0.98,1.01))+
  geom_smooth(method = 'lm')+
  ggtitle("Alcohol by Density") + 
  labs(x = 'Density',y = 'Alcohol')
```


### 描述二
这部分主要根据变量之间的相关性和自己的直觉选择一些变量进行观察：
1. 可以看出残糖和密度之间很明显的线性关系，随着残糖含量的提升，密度将会变大，可能会造成口感上更粘稠和厚重。
2.酒精和密度却成负相关，可能因为酒精比水的密度小

### 绘图三
```{r echo=FALSE, Plot_Three}
ggplot(aes(x = alcohol, y = density, color = quality), data = data_white_wine_origin) + 
  geom_jitter(alpha = 0.25, color=I('#F79420')) + 
  geom_smooth(method = "lm", se = FALSE,size=1) + 
  ylim(0.985, 1.005) + 
  labs(y = 'Density',x = 'Alcohol') + 
  ggtitle("density VS alcohol VS quality")
```

```{r echo=FALSE}
ggplot(aes(x = density, y = alcohol), 
      data = data_white_wine_origin)  + 
  geom_point(aes(alpha=0.2),position = position_jitter())+
  xlim(c(0.98,1.01))+
  geom_smooth(method = 'lm')+
  ggtitle("Alcohol by Density") + 
  labs(x = 'Density',y = 'Alcohol')
```


### 描述三
由图可知：
1. 酒精含量（alcohol）一定时，密度（density）越高，quality的颜色越深，也就是说质量更高
2.残糖含量（residual.sugar）较低的时候，颜色比较深，意味着大多数评分高的酒残糖含量并不高

------

# 反思

### 预期与结果
起初的预期中，一定会有一些客观化学参数会影响葡萄酒的质量（quality），但实际的探索结果中没有发现哪一个指标因素与质量有直接的关系；
猜测：
1. 评分的因素不完全是口感，而数据集中的因素几乎全与口感相关；
2. 数据集中提供的指标并不完整

### 遇到的问题
在R的各种方法使用过程中，并不是特别熟悉，故而有时候并不能很快找到最适合的表现方式，这部分需要再多熟悉。   




